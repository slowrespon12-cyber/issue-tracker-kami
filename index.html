<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Issue Tracker Helpdesk</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
 font-family:Arial,sans-serif;
 background:linear-gradient(90deg,#e3f2fd,#fff,#e3f2fd);
 margin:0;
}

.container{
 max-width:900px;
 margin:40px auto;
 background:#fff;
 padding:30px;
 border-radius:14px;
 box-shadow:0 10px 30px rgba(0,0,0,.08);
}

/* HEADER */

.header{
 text-align:center;
 padding:25px;
 margin-bottom:30px;
 border-radius:12px;
 background:linear-gradient(135deg,#42a5f5,#64b5f6);
 color:#fff;
 animation:glow 4s infinite;
}

.icon-wrap{
 position:relative;
 display:inline-block;
 margin-bottom:10px;
}

.book{
 font-size:56px;
 animation:floatBook 3s ease-in-out infinite;
}

.gear{
 position:absolute;
 right:-28px;
 bottom:-10px;
 font-size:34px;
 animation:spin 2.5s linear infinite;
}

/* ANIMATION */

@keyframes spin{
 from{transform:rotate(0)}
 to{transform:rotate(360deg)}
}

@keyframes floatBook{
 0%,100%{transform:translateY(0)}
 50%{transform:translateY(-6px)}
}

@keyframes glow{
 0%,100%{box-shadow:0 0 10px rgba(255,255,255,.3)}
 50%{box-shadow:0 0 25px rgba(255,255,255,.6)}
}

/* INPUT */

input{
 width:100%;
 padding:14px;
 font-size:16px;
 border-radius:10px;
 border:1px solid #cfd8dc;
 margin-bottom:24px;
}

/* ISSUE */

.issue-item{
 border:1px solid #e0e0e0;
 border-radius:10px;
 margin-bottom:14px;
 overflow:hidden;
}

.issue-header{
 padding:16px;
 font-weight:bold;
 color:#1976d2;
 cursor:pointer;
 background:#fafafa;
}

.issue-header:hover{background:#f1f8ff}

.issue-detail{
 display:none;
 padding:16px;
 border-top:1px dashed #ccc;
 line-height:1.6;
}

.section{margin-bottom:14px}

.section h4{
 margin:0 0 6px;
 color:#1565c0;
}

img{
 max-width:100%;
 border-radius:10px;
 margin-top:10px;
}

.footer{
 text-align:center;
 margin-top:40px;
 color:#777;
 font-size:13px;
}
</style>
</head>

<body>

<div class="container">

<div class="header">
<div class="icon-wrap">
 <span class="book">üìò</span>
 <span class="gear">‚öôÔ∏è</span>
</div>
<h1>Issue Tracker Helpdesk</h1>
<p>Pusat solusi internal</p>
</div>

<input id="search" placeholder="Cari issue...">

<div id="list"></div>

<div class="footer">
¬© Helpdesk <span id="year"></span>
</div>

</div>

<script>
document.getElementById("year").textContent=new Date().getFullYear();

/* GOOGLE SHEET CSV */

const SHEET_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQCLXvz4_F7EfUppPoKWSKQawlesCjiYHhceQCIEDoV8ntbDjFrvKUorP416AGydpWYmxWlOLA3b1JL/pub?gid=0&single=true&output=csv&t="+Date.now();

let issues=[];
let opened=null;

/* LOAD SHEET */

Papa.parse(SHEET_URL,{
 download:true,
 header:true,
 skipEmptyLines:true,
 complete:r=>{
  issues=r.data.map(x=>({
   issue:(x.issue||"").trim(),
   solusi:(x.solusi||"").trim(),
   image_id:(x.image_id||"").trim()
  })).filter(i=>i.issue);
 }
});

/* newline -> <br> */

function nl(t){
 return t.replace(/\n/g,"<br>");
}

/* RENDER */

function render(data){

 const list=document.getElementById("list");
 list.innerHTML="";

 if(!data.length){
  list.innerHTML="<div style='color:#999'>Issue tidak ditemukan</div>";
  return;
 }

 data.forEach(item=>{

  const wrap=document.createElement("div");
  wrap.className="issue-item";

  const h=document.createElement("div");
  h.className="issue-header";
  h.textContent=item.issue;

  const d=document.createElement("div");
  d.className="issue-detail";

  d.innerHTML=`
<div class="section">
<h4>Solusi</h4>
${nl(item.solusi)||"-"}
</div>

${item.image_id && item.image_id!=="kosong"
?`<img src="https://drive.google.com/thumbnail?id=${item.image_id}&sz=w1200">`
:""}
`;

  h.onclick=()=>{
   if(opened && opened!==d) opened.style.display="none";
   d.style.display=d.style.display==="block"?"none":"block";
   opened=d.style.display==="block"?d:null;
  };

  wrap.appendChild(h);
  wrap.appendChild(d);
  list.appendChild(wrap);
 });
}

/* SEARCH ONLY */

document.getElementById("search").addEventListener("input",e=>{
 const k=e.target.value.toLowerCase().trim();
 if(!k){
  document.getElementById("list").innerHTML="";
  return;
 }
 render(issues.filter(i=>i.issue.toLowerCase().includes(k)));
});
</script>

</body>
</html>
